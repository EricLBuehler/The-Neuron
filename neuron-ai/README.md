# Neuron AI

## AI architecture
### Overview
The Neuron utilizes a PerceiverIO model for autonomous driving. The model is built using PyTorch, and is effectively a classifier.

### Architecture
The AI used in this application is based on a PerceiverIO. However, several multilayer perceptrons are built in to the model for things such as query generation and tensor dimension mapping. The PerceiverIO input dimension is 512, and the logits dimension is 5. The model's depth is 12, and has a ```latent_dim``` of 784, and a ```num_latents``` of 512. The PerceiverIO also has the decoder feed-forward enabled.

### Multilayer perceptrons
I employ 3 multilayer perceptrons (fully connected feedforward ANN), also known as MLPs, to generate the queries and to act as secondary models. I have found using MLPs to be effective, as having one network generate a partial solution, then another finalize the solution generated by the PerceiverIO seems to be helpful.

### Initial MLP
To prepare the input for processing, the channels dimension of the input images are scaled up to ```embed_dim``` using an intial multilayer perceptron. This multilayer perceptron converts the input from ```BS x IMRESY x IMRESX x 3``` to ```BS x IMRESY x IMRESX x embed_dim```.

### Input encoding
2 main types of input encoding are used:
- Convolutions
- Positional embedding

Convoloutions are set up in an encode-decode fashion, with a skip connection at the end to the input.
Positional embeddings are then applied to the ouput of the convolutions and skip connecitons. The convolutions and the output of the positional embeddings are then concatenated to form the input for the PerceiverIO and the query generator

### Query generation
I use a multilayer perceptron to generate queries. The query generator scales the input dimension of the model (512) up to 1024, and then down to the query dimension (256). The query generator takes the PerceiverIO input as the input, and the output is directly used as the query for the PerceiverIO.

### Final MLP
The final output from the PerceiverIO is very high dimensional (```BS x 12800 x5```), and so I use a final multilayer perceptron to convert the high dimensional tensor down into a lower dimension. After the final multilayer perceptron, which consists of 7 layers, the dimension of the ouput is ```BS x 1 x 5```.

## Training

### Model training process

Before training, ensure that the ```prefix``` variable is set to the correct working directory, which must also include the dataset.
The ```modelname``` variable should also be set to your desired value.
This code is designed to be run on Google Colab. If you are using a CPU instance, be sure to set the ```CPUonly``` to True.
If you are using a GPU instance, ```CPUonly``` should be False.

### Dataset

The dataset used to train this model should be found in the ```prefix``` directory, and should be generated by the Neuron data collection program.
The dataset directory needs to contain the CSV file for data loading, as well as a sub directory ```images```, which contains the depth camera images.

### Training results

The train program will output a final model in PyTorch ```.pth``` format, as well loss and accuracy logs.

## Visualizing results
Before visualizing results, ensure that the ```prefix``` variable is set to the correct working directory, and that the variable ```modelname``` corresponds to the correct model.
